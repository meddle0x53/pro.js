!function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a():window.Pro=a()}(function(){{var a={},b=Array.prototype,c=b.concat,d=b.every,e=b.filter,f=b.forEach,g=b.indexOf,h=b.join,i=b.lastIndexOf,j=b.map,k=b.pop,l=b.push,m=b.reduce,n=b.reduceRight,o=b.reverse,p=b.shift,q=b.slice,r=b.some,s=b.sort,t=b.splice,u=b.toLocaleString,v=b.toString;b.unshift}return a.States={init:1,ready:2,destroyed:3,error:4},a.Utils=a.U={isFunction:function(a){return"function"==typeof a},isString:function(a){return"string"==typeof a},isObject:function(a){return"object"==typeof a},isError:function(b){return null!==b&&a.U.isObject(b)&&b.message&&"[object Error]"===Object.prototype.toString.apply(b)},isArray:function(b){return a.U.isObject(b)&&"[object Array]"===Object.prototype.toString.call(b)},isProArray:function(b){return null!==b&&a.U.isObject(b)&&a.U.isArray(b._array)&&void 0!==b.length},isArrayObject:function(b){return a.U.isArray(b)||a.U.isProArray(b)},isProObject:function(b){return b&&a.U.isObject(b)&&void 0!==b.__pro__&&a.U.isObject(b.__pro__.properties)},isProVal:function(b){return a.U.isProObject(b)&&void 0!==b.__pro__.properties.v},ex:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},contains:function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1},remove:function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},diff:function(b,c){var d,e,f,g=-1,h=b.length,i=c.length,j={};if(h>=i){for(d=0;i>d;d++)e=b[d],f=c[d],e!==f?(-1===g&&(g=d),j[g]=j[g]||{o:[],n:[]},j[g].o.push(e),j[g].n.push(f)):g=-1;for(-1===g&&(g=d),j[g]=j[g]||{o:[],n:[]};h>d;d++)e=b[d],j[g].o.push(e)}else if(i>h){j=a.U.diff(c,b);for(d in j)el1=j[d],el2=el1.n,el1.n=el1.o,el1.o=el2}return j}},a.Configuration={keyprops:!0,keypropList:["p"]},a.N=function(){},a.currentCaller=null,a.Queue=function(a,b){this.name=a||"proq",this.options=b||{},this._queue=[]},a.Queue.runAction=function(a,b,c,d,e){if(d&&d.length>0)if(e)try{c.apply(b,d)}catch(f){e(a,f)}else c.apply(b,d);else if(e)try{c.call(b)}catch(f){e(a,f)}else c.call(b)},a.U.ex(a.Queue.prototype,{constructor:a.Queue,length:function(){return this._queue.length/4},isEmpty:function(){return 0===this.length()},push:function(b,c,d){b&&a.Utils.isFunction(b)&&(d=c,c=b,b=null),this._queue.push(b,c,d,1)},pushOnce:function(b,c,d){b&&a.Utils.isFunction(b)&&(d=c,c=b,b=null);var e,f,g,h=this._queue,i=h.length;for(g=0;i>g;g+=4)if(e=h[g],f=h[g+1],e===b&&f===c)return h[g+2]=d,void(h[g+3]=h[g+3]+1);this.push(b,c,d)},go:function(b){var c,d,e,f,g,h=this._queue,i=this.options,j=(this.runs,h.length),k=i&&i.before,l=i&&i.after,m=i&&i.err,n=j,o=!0,p=1,q=n;for(j&&k&&k(this);o;){for(o=!1,n=q,c=0;n>c;c+=4)d=h[c],e=h[c+1],f=h[c+2],g=h[c+3],g===p?a.Queue.runAction(this,d,e,f,m):g>p&&(o=!0,q=c+4);p+=1}j&&l&&l(this),h.length>j?(this._queue=h.slice(j),b||this.go()):this._queue.length=0}}),a.Queues=function(b,c){b||(b=["proq"]),this.queueNames=b,this.options=c||{},this._queues={};var d,e=this.queueNames.length;for(d=0;e>d;d++)this._queues[this.queueNames[d]]=new a.Queue(this.queueNames[d],this.options.queue)},a.Queues.prototype={},a.Queues.prototype.isEmpty=function(){var a,b,c,d=this._queues,e=this.queueNames,f=e.length;for(a=0;f>a;a++)if(b=e[a],c=d[b],!c.isEmpty())return!1;return!0},a.Queues.prototype.push=function(b,c,d,e){b&&!a.Utils.isString(b)&&(e=d,d=c,c=b,b=this.queueNames[0]),b||(b=this.queueNames[0]);var f=this._queues[b];f&&f.push(c,d,e)},a.Queues.prototype.pushOnce=function(b,c,d,e){b&&!a.Utils.isString(b)&&(e=d,d=c,c=b,b=this.queueNames[0]),b||(b=this.queueNames[0]);var f=this._queues[b];f&&f.pushOnce(c,d,e)},a.Queues.prototype.go=function(a){var b,c,d,e,f=0,g=this._queues,h=this.queueNames,i=this.queueNames.length;if(a)for(b=0;i>b;b++)h[b]===a&&(f=b);for(;i>f;)c=h[f],d=g[c],d.go(!0),-1===(e=this.probePrevIndex(f))?f+=1:f=e},a.Queues.prototype.probePrevIndex=function(a){var b,c,d,e=this._queues,f=this.queueNames;for(b=0;a>=b;b++)if(c=f[b],d=e[c],!d.isEmpty())return b;return-1},a.Flow=function(a,b){a||(a=["proq"]),this.queueNames=a,this.options=b||{},this.flowInstance=null,this.flowInstances=[],this.pauseMode=!1},a.Flow.prototype={constructor:a.Flow,start:function(){var b=this.flowInstance,c=this.options,d=c&&c.start,e=this.queueNames;b&&this.flowInstances.push(b),this.flowInstance=new a.Queues(e,c.flowInstance),d&&d(this.flowInstance)},stop:function(){var a,b=this.flowInstance,c=this.options,d=c&&c.stop;if(b)try{b.go()}finally{this.flowInstance=null,this.flowInstances.length&&(a=this.flowInstances.pop(),this.flowInstance=a),d&&d(b)}},pause:function(){this.pauseMode=!0},resume:function(){this.pauseMode=!1},run:function(a,b){var c=this.options,d=c.err;this.start(),b||(b=a,a=null);try{if(d)try{b.call(a)}catch(e){d(e)}else b.call(a)}finally{this.stop()}},isRunning:function(){return null!==this.flowInstance&&void 0!==this.flowInstance},isPaused:function(){return this.isRunning()&&this.pauseMode},push:function(a,b,c,d){if(!this.flowInstance)throw new Error("Not in running flow!");this.isPaused()||this.flowInstance.push(a,b,c,d)},pushOnce:function(a,b,c,d){if(!this.flowInstance)throw new Error("Not in running flow!");this.isPaused()||this.flowInstance.pushOnce(a,b,c,d)}},a.flow=new a.Flow(["proq"],{err:function(b){a.flow.errStream()?a.flow.errStream().triggerErr(b):console.log(b)},flowInstance:{queue:{err:function(b,c){a.flow.errStream()?a.flow.errStream().triggerErr(c):console.log(c)}}}}),a.Observable=function(){this.listeners=[],this.errListeners=[],this.sources=[],this.listener=null,this.errListener=null},a.Observable.prototype={constructor:a.Observable,makeListener:function(){return null},makeErrListener:function(){return null},makeEvent:function(b){return new a.Event(b,this,a.Event.Types.value)},on:function(b,c,d){return a.U.isString(b)||(c=b),a.U.isArray(d)?d.push(c):this.listeners.push(c),this},off:function(b,c,d){return b||c?(a.U.isString(b)||(c=b),a.U.isArray(d)?a.U.remove(d,c):a.U.remove(this.listeners,c),this):void(a.U.isArray(d)?d.length=0:this.listeners=[])},onErr:function(a,b){return this.on(a,b,this.errListeners)},offErr:function(a,b){return this.off(a,b,this.errListeners)},into:function(a){return this.sources.push(a),a.on(this.makeListener()),a.onErr(this.makeErrListener()),this},out:function(a){return a.into(this),this},offSource:function(b){return a.U.remove(this.sources,b),b.off(this.listener),b.offErr(this.errListener),this},map:a.N,update:function(b,c){var d=this;return a.flow.isRunning()?d.willUpdate(b,c):a.flow.run(function(){d.willUpdate(b,c)}),this},willUpdate:function(b,c){var d,e,f=a.U.isArray(c)?c:this.listeners,g=f.length,h=this.makeEvent(b);for(d=0;g>d;d++)e=f[d],this.defer(h,e),e.property&&e.property.willUpdate(h);return this},defer:function(b,c){return a.U.isFunction(c)?a.flow.pushOnce(c,[b]):a.flow.pushOnce(c,c.call,[b]),this}},a.Event=function(a,b,c){this.source=a,this.target=b,this.type=c,this.args=q.call(arguments,3)},a.Event.Types={value:0,array:1,close:2,error:3},a.Stream=function(b,c){this.transforms=c?c:[],a.Observable.call(this),b&&this.into(b)},a.Stream.BadValue={},a.Stream.prototype=a.U.ex(Object.create(a.Observable.prototype),{constructor:a.Stream,makeEvent:function(a){return a},makeListener:function(){if(!this.listener){var a=this;this.listener=function(b){a.trigger(b,!0)}}return this.listener},makeErrListener:function(){if(!this.errListener){var a=this;this.errListener=function(b){a.triggerErr(b)}}return this.errListener},defer:function(b,c){return c.property?void a.Observable.prototype.defer.call(this,b,c):void(a.Utils.isFunction(c)?a.flow.push(c,[b]):a.flow.push(c,c.call,[b]))},trigger:function(a,b){return this.go(a,b)},triggerErr:function(a){return this.update(a,this.errListeners)},go:function(b,c){var d,e=this.transforms,f=e.length;if(c)try{for(d=0;f>d;d++)b=e[d].call(this,b)}catch(g){return this.triggerErr(g),this}return b===a.Stream.BadValue?this:this.update(b)},map:function(b){return new a.Stream(this,[b])},filter:function(b){var c,d=this;return c=function(c){return b.call(d,c)?c:a.Stream.BadValue},new a.Stream(this,[c])},accumulate:function(b,c){var d,e=this,f=b;return d=function(a){return f=c.call(e,f,a)},new a.Stream(this,[d])},reduce:function(b,c){return new a.Val(b).into(this.accumulate(b,c))},merge:function(b){return new a.Stream(this).into(b)}}),a.U.ex(a.Flow.prototype,{errStream:function(){return this.errStreamVar||(this.errStreamVar=new a.Stream),this.errStreamVar}}),a.BufferedStream=function(b,c){a.Stream.call(this,b,c),this.buffer=[]},a.BufferedStream.prototype=a.U.ex(Object.create(a.Stream.prototype),{flush:function(){var b,c=this,d=this.buffer,e=d.length;a.flow.run(function(){for(b=0;e>b;b+=2)c.go(d[b],d[b+1]);c.buffer=[]})}}),a.BufferedStream.prototype.constructor=a.BufferedStream,a.SizeBufferedStream=function(b,c,d){if(1===arguments.length&&"number"==typeof b?(d=b,b=null):2===arguments.length&&"number"==typeof c&&(d=c,c=null),a.BufferedStream.call(this,b,c),!d)throw new Error("SizeBufferedStream must contain size!");this.size=d},a.SizeBufferedStream.prototype=a.U.ex(Object.create(a.BufferedStream.prototype),{trigger:function(a,b){this.buffer.push(a,b),null!==this.size&&this.buffer.length/2===this.size&&this.flush()}}),a.SizeBufferedStream.prototype.constructor=a.SizeBufferedStream,a.U.ex(a.Stream.prototype,{bufferit:function(b){return new a.SizeBufferedStream(this,b)}}),a.DelayedStream=function(b,c,d){"number"==typeof b?(d=b,b=null):a.U.isObject(b)&&"number"==typeof c&&(d=c,c=null),a.BufferedStream.call(this,b,c),this.delayId=null,this.setDelay(d)},a.DelayedStream.prototype=a.U.ex(Object.create(a.BufferedStream.prototype),{trigger:function(a,b){this.buffer.push(a,b)},cancelDelay:function(){null!==this.delayId&&(clearInterval(this.delayId),this.delayId=null)},setDelay:function(a){if(this.delay=a,!this.delay)throw new Error("DelayedStream must contain delay!");var b=this;this.delayId=setInterval(function(){b.flush()},this.delay)}}),a.DelayedStream.prototype.constructor=a.DelayedStream,a.U.ex(a.Stream.prototype,{delay:function(b){return new a.DelayedStream(this,b)}}),a.ThrottlingStream=function(b,c,d){a.DelayedStream.call(this,b,c,d)},a.ThrottlingStream.prototype=a.U.ex(Object.create(a.DelayedStream.prototype),{trigger:function(a,b){this.buffer=[],this.buffer.push(a,b)}}),a.ThrottlingStream.prototype.constructor=a.ThrottlingStream,a.U.ex(a.Stream.prototype,{throttle:function(b){return new a.ThrottlingStream(this,b)}}),a.DebouncingStream=function(b,c,d){a.DelayedStream.call(this,b,c,d)},a.DebouncingStream.prototype=a.U.ex(Object.create(a.DelayedStream.prototype),{trigger:function(a,b){this.buffer=[],this.cancelDelay(),this.setDelay(this.delay),this.buffer.push(a,b)}}),a.DebouncingStream.prototype.constructor=a.DebouncingStream,a.U.ex(a.Stream.prototype,{debounce:function(b){return new a.DebouncingStream(this,b)}}),a.Array=function(){this._array=0===arguments.length?[]:1===arguments.length&&a.U.isArray(arguments[0])?arguments[0]:q.call(arguments),this.indexListeners=[],this.lastIndexCaller=null,this.lengthListeners=[],this.lastLengthCaller=null;var b,c,d,e,f=this;b=function(){return f.addLengthCaller(),f._array.length},c=function(b){return f._array.length!==b?(e=f._array.length,f._array.length=b,a.flow.run(function(){f.willUpdate(a.Array.Operations.setLength,-1,e,b)}),b):void 0},Object.defineProperty(this,"length",{configurable:!1,enumerable:!0,get:b,set:c}),Object.defineProperty(this,"__pro__",{enumerable:!1,configurable:!1,writeble:!1,value:{}}),this.__pro__.state=a.States.init;try{for(d=0;d<this._array.length;d++)this.defineIndexProp(d);this.__pro__.state=a.States.ready}catch(g){throw this.__pro__.state=a.States.error,g}},a.Array.prototype=Object.create(b),a.Array.prototype.constructor=a.Array,a.Array.Operations={set:0,add:1,remove:2,setLength:3,reverse:4,sort:5,splice:6,isIndexOp:function(a){return a===this.set||a===this.reverse||a===this.sort}},a.Array.reFilter=function(a,b,c){var d=b._array;b._array=e.apply(a._array,c),b.updateByDiff(d)},a.Array.prototype.addLengthListener=function(a){this.lengthListeners.push(a)},a.Array.prototype.addLengthCaller=function(){var b=a.currentCaller;b&&this.lastLengthCaller!==b&&!a.U.contains(this.lengthListeners,b)&&(this.addLengthListener(b),this.lastLengthCaller=b)},a.Array.prototype.addIndexListener=function(a){this.indexListeners.push(a)},a.Array.prototype.addIndexCaller=function(){var b=a.currentCaller;b&&this.lastIndexCaller!==b&&!a.U.contains(this.indexListeners,b)&&(this.addIndexListener(b),this.lastIndexCaller=b)},a.Array.prototype.on=function(a){this.addIndexListener(a),this.addLengthListener(a)},a.Array.prototype.defineIndexProp=function(b){var c,d=this,e=d._array,f=a.U.isArray,g=a.U.isObject,h=a.U.isFunction;f(e[b])?new a.ArrayProperty(e,b):h(e[b])||null===e[b]||g(e[b])&&new a.ObjectProperty(e,b),Object.defineProperty(this,b,{enumerable:!0,configurable:!0,get:function(){return d.addIndexCaller(),e[b]},set:function(f){e[b]!==f&&(c=e[b],e[b]=f,a.flow.run(function(){d.willUpdate(a.Array.Operations.set,b,c,f)}))}})},a.Array.prototype.willUpdate=function(b,c,d,e){var f=a.Array.Operations.isIndexOp(b)?this.indexListeners:this.lengthListeners;this.willUpdateListeners(f,b,c,d,e)},a.Array.prototype.willUpdateSplice=function(b,c,d){var e,f=a.Array.Operations.splice;c&&d&&(0!==c.length||0!==d.length)&&(e=c.length===d.length?this.indexListeners:d.length&&c.length?this.lengthListeners.concat(this.indexListeners):this.lengthListeners,this.willUpdateListeners(e,f,b,c,d))},a.Array.prototype.willUpdateListeners=function(b,c,d,e,f){var g,h,i=b.length,j=new a.Event(void 0,this,a.Event.Types.array,c,d,e,f);for(g=0;i>g;g++)h=b[g],a.U.isFunction(h)?a.flow.pushOnce(h,[j]):a.flow.pushOnce(h,h.call,[j]),h.property&&h.property.willUpdate(j)},a.Array.prototype.updateByDiff=function(b){var c,d,e=this,f=a.U.diff(b,this._array);a.flow.run(function(){for(c in f)d=f[c],d&&e.willUpdateSplice(c,d.o,d.n)})},a.Array.prototype.concat=function(){var b,d;return 1===arguments.length&&a.U.isProArray(arguments[0])&&(d=arguments[0],arguments[0]=d._array),b=new a.Array(c.apply(this._array,arguments)),d?(this.on(a.Array.Listeners.leftConcat(b,this,d)),d.on(a.Array.Listeners.rightConcat(b,this,d))):this.on(a.Array.Listeners.leftConcat(b,this,q.call(arguments,0))),b},a.Array.prototype.every=function(){return this.addIndexCaller(),this.addLengthCaller(),d.apply(this._array,arguments)},a.Array.prototype.pevery=function(){var b=new a.Val(d.apply(this._array,arguments));return this.on(a.Array.Listeners.every(b,this,arguments)),b},a.Array.prototype.some=function(){return this.addIndexCaller(),this.addLengthCaller(),r.apply(this._array,arguments)},a.Array.prototype.psome=function(){var b=new a.Val(r.apply(this._array,arguments));return this.on(a.Array.Listeners.some(b,this,arguments)),b},a.Array.prototype.forEach=function(){return this.addIndexCaller(),this.addLengthCaller(),f.apply(this._array,arguments)},a.Array.prototype.filter=function(){var b=new a.Array(e.apply(this._array,arguments));return this.on(a.Array.Listeners.filter(b,this,arguments)),b},a.Array.prototype.map=function(){var b=new a.Array(j.apply(this._array,arguments));return this.on(a.Array.Listeners.map(b,this,arguments)),b},a.Array.prototype.reduce=function(){return this.addIndexCaller(),this.addLengthCaller(),m.apply(this._array,arguments)},a.Array.prototype.preduce=function(){var b=new a.Val(m.apply(this._array,arguments));return this.on(a.Array.Listeners.reduce(b,this,arguments)),b},a.Array.prototype.reduceRight=function(){return this.addIndexCaller(),this.addLengthCaller(),n.apply(this._array,arguments)},a.Array.prototype.preduceRight=function(){var b=new a.Val(n.apply(this._array,arguments));return this.on(a.Array.Listeners.reduceRight(b,this,arguments)),b},a.Array.prototype.indexOf=function(){return this.addIndexCaller(),this.addLengthCaller(),g.apply(this._array,arguments)},a.Array.prototype.pindexOf=function(){var b=new a.Val(g.apply(this._array,arguments));return this.on(a.Array.Listeners.indexOf(b,this,arguments)),b},a.Array.prototype.lastIndexOf=function(){return this.addIndexCaller(),this.addLengthCaller(),i.apply(this._array,arguments)},a.Array.prototype.plastindexOf=function(){var b=new a.Val(i.apply(this._array,arguments));return this.on(a.Array.Listeners.lastIndexOf(b,this,arguments)),b},a.Array.prototype.join=function(){return this.addIndexCaller(),this.addLengthCaller(),h.apply(this._array,arguments)},a.Array.prototype.pjoin=function(b){var c=this.preduce(function(a,c){return a+b+c},""),d=new a.Val(function(){return c.v?c.v.substring(1):""});return d},a.Array.prototype.toLocaleString=function(){return this.addIndexCaller(),this.addLengthCaller(),u.apply(this._array,arguments)},a.Array.prototype.toString=function(){return this.addIndexCaller(),this.addLengthCaller(),v.apply(this._array,arguments)},a.Array.prototype.valueOf=function(){return this.toArray()},a.Array.prototype.slice=function(){var b=new a.Array(q.apply(this._array,arguments));return this.on(a.Array.Listeners.slice(b,this,arguments)),b},a.Array.prototype.reverse=function(){if(0!==this._array.length){var b=o.apply(this._array,arguments),c=this;return a.flow.run(function(){c.willUpdate(a.Array.Operations.reverse,-1,null,null)}),b}},a.Array.prototype.sort=function(){if(0!==this._array.length){var b=s.apply(this._array,arguments),c=this,d=arguments;return a.flow.run(function(){c.willUpdate(a.Array.Operations.sort,-1,null,d)}),b}},a.Array.prototype.splice=function(b,c){var d,e=this._array.length,f=t.apply(this._array,arguments),g=this._array.length,h=this,i=q.call(arguments,2);if(b=~b?b:g-b,c=(null==c?g-b:c)||0,i.length>c)for(d=i.length-c;d--;)this.defineIndexProp(e++);else if(c>i.length)for(d=c-i.length;d--;)delete this[--e];return a.flow.run(function(){h.willUpdateSplice(b,f,i)}),new a.Array(f)},a.Array.prototype.pop=function(){if(0!==this._array.length){var b=k.apply(this._array,arguments),c=this,d=this._array.length;return delete this[d],a.flow.run(function(){c.willUpdate(a.Array.Operations.remove,c._array.length,b,null)}),b}},a.Array.prototype.push=function(){var b,c,d=arguments,e=arguments.length,f=this;for(b=0;e>b;b++)c=this._array.length,l.call(this._array,arguments[b]),this.defineIndexProp(c);return a.flow.run(function(){f.willUpdate(a.Array.Operations.add,f._array.length-1,null,q.call(d,0))}),this._array.length},a.Array.prototype.shift=function(){if(0!==this._array.length){var b=p.apply(this._array,arguments),c=this,d=this._array.length;return delete this[d],a.flow.run(function(){c.willUpdate(a.Array.Operations.remove,0,b,null)}),b}},a.Array.prototype.unshift=function(){for(var b,c=q.call(arguments,0),d=arguments.length,e=this._array,f=this,b=0;d>b;b++)e.splice(b,0,arguments[b]),this.defineIndexProp(e.length-1);return a.flow.run(function(){f.willUpdate(a.Array.Operations.add,0,null,c)}),e.length},a.Array.prototype.toArray=function(){var b,c,d=[],e=this._array,f=e.length,g=a.U.isProArray;for(b=0;f>b;b++)c=e[b],g(c)&&(c=c.toArray()),d.push(c);return d},a.Array.prototype.toJSON=function(){return JSON.stringify(this._array)},a.Array.Listeners=a.Array.Listeners||{check:function(b){if(b.type!==a.Event.Types.array)throw Error("Not implemented for non array events")}},a.Array.Listeners.leftConcat=function(b,d,e){return function(f){a.Array.Listeners.check(f);var g,h,i=f.args[0],j=f.args[1],k=f.args[2],l=f.args[3],m=e.length;i===a.Array.Operations.set?b[j]=l:i===a.Array.Operations.add?(g=q.call(l,0),0===j?a.Array.prototype.unshift.apply(b,g):a.Array.prototype.splice.apply(b,[b._array.length-m,0].concat(g))):i===a.Array.Operations.remove?0===j?a.Array.prototype.shift.call(b,k):a.Array.prototype.splice.apply(b,[b._array.length-m-1,1]):i===a.Array.Operations.setLength?(g=k-l,g>0?a.Array.prototype.splice.apply(b,[l,g]):(h=[k,0],h.length=2-g,a.Array.prototype.splice.apply(b,h))):i===a.Array.Operations.reverse||i===a.Array.Operations.sort?(g=b._array,h=a.Utils.isProArray(e)?e._array:e,b._array=c.apply(d._array,h),b.updateByDiff(g)):i===a.Array.Operations.splice&&a.Array.prototype.splice.apply(b,[j,k.length].concat(l))}},a.Array.Listeners.rightConcat=function(b,d,e){return function(f){a.Array.Listeners.check(f);var g,h=f.args[0],i=f.args[1],j=f.args[2],k=f.args[3],l=d._array.length;h===a.Array.Operations.set?b[l+i]=k:h===a.Array.Operations.add?0===i?a.Array.prototype.splice.apply(b,[l,0].concat(k)):a.Array.prototype.push.apply(b,k):h===a.Array.Operations.remove?0===i?a.Array.prototype.splice.call(b,l,1):a.Array.prototype.pop.call(b,j):h===a.Array.Operations.setLength?b.length=l+k:h===a.Array.Operations.reverse||h===a.Array.Operations.sort?(g=b._array,b._array=c.apply(d._array,e._array),b.updateByDiff(g)):h===a.Array.Operations.splice&&a.Array.prototype.splice.apply(b,[i+l,j.length].concat(k))}},a.Array.Listeners.every=function(b,c,e){var f=e[0],g=e[1];return function(h){a.Array.Listeners.check(h);var i,j=h.args[0],k=(h.args[1],h.args[2]),l=h.args[3];j===a.Array.Operations.set?(i=f.call(g,l),b.valueOf()!==!0||i?b.valueOf()===!1&&i&&(b.v=d.apply(c._array,e)):b.v=!1):j===a.Array.Operations.add?b.valueOf()===!0&&(b.v=d.call(l,f,g)):j===a.Array.Operations.remove?b.valueOf()!==!1||f.call(g,k)||(b.v=d.apply(c._array,e)):j===a.Array.Operations.setLength?b.valueOf()===!1&&(b.v=d.apply(c._array,e)):j===a.Array.Operations.splice&&(b.valueOf()===!0?b.v=d.call(l,f,g):d.call(l,f,g)&&!d.call(k,f,g)&&(b.v=d.apply(c._array,e)))}},a.Array.Listeners.some=function(b,c,d){var e=d[0],f=d[1];return function(g){a.Array.Listeners.check(g);var h,i=g.args[0],j=(g.args[1],g.args[2]),k=g.args[3];i===a.Array.Operations.set?(h=e.call(f,k),b.valueOf()===!1&&h?b.v=!0:b.valueOf()!==!0||h||(b.v=r.apply(c._array,d))):i===a.Array.Operations.add?b.valueOf()===!1&&(b.v=r.call(k,e,f)):i===a.Array.Operations.remove?b.valueOf()===!0&&e.call(f,j)&&(b.v=r.apply(c._array,d)):i===a.Array.Operations.setLength?b.valueOf()===!0&&(b.v=r.apply(c._array,d)):i===a.Array.Operations.splice&&(b.valueOf()===!1?b.v=r.call(k,e,f):r.call(j,e,f)&&!r.call(k,e,f)&&(b.v=r.apply(c._array,d)))}},a.Array.Listeners.filter=function(b,c,d){var e=d[0],f=d[1];return function(g){a.Array.Listeners.check(g);var h,i,j,k,l,m,n=g.args[0],o=g.args[1],p=g.args[2],r=g.args[3];if(n===a.Array.Operations.set)h=e.call(f,r),i=e.call(f,p),(i===!0||h===!0)&&a.Array.reFilter(c,b,d);else if(n===a.Array.Operations.add)if(k=[],j=q.call(r,0),m=j.length,0===o){for(l=m-1;l>=0;)e.apply(f,[j[l],l,c._array])&&k.unshift(j[l]),l--;k.length&&a.Array.prototype.unshift.apply(b,k)}else{for(l=0;m>l;)e.apply(f,[j[l],c._array.length-(m-l),c._array])&&k.push(j[l]),l++;k.length&&a.Array.prototype.push.apply(b,k)}else n===a.Array.Operations.remove?e.apply(f,[p,o,c._array])&&(0===o?b.shift():b.pop()):n===a.Array.Operations.setLength?a.Array.reFilter(c,b,d):n===a.Array.Operations.reverse?b.reverse():n===a.Array.Operations.sort?a.Array.prototype.sort.apply(b,r):n===a.Array.Operations.splice&&a.Array.reFilter(c,b,d)}},a.Array.Listeners.map=function(b,c,d){var e=d[0],f=d[1];return function(d){a.Array.Listeners.check(d);var g,h,i,j,k=d.args[0],l=d.args[1],m=d.args[2],n=d.args[3];if(k===a.Array.Operations.set)b[l]=e.call(f,n);else if(k===a.Array.Operations.add)if(j=[],g=q.call(n,0),i=g.length,0===l){for(h=i-1;h>=0;)j[h]=e.apply(f,[g[h],h,c._array]),h--;a.Array.prototype.unshift.apply(b,j)}else{for(h=0;i>h;)j[h]=e.apply(f,[g[h],c._array.length-(i-h),c._array]),h++;a.Array.prototype.push.apply(b,j)}else if(k===a.Array.Operations.remove)0===l?b.shift():b.pop();else if(k===a.Array.Operations.setLength)b.length=n;else if(k===a.Array.Operations.reverse)b.reverse();else if(k===a.Array.Operations.sort)a.Array.prototype.sort.apply(b,n);else if(k===a.Array.Operations.splice){for(j=[],h=0;h<n.length;)j[h]=e.apply(f,[n[h],h+l,c._array]),h++;a.Array.prototype.splice.apply(b,[l,m.length].concat(j))}}},a.Array.Listeners.reduce=function(b,c,d){var e=c._array.length,f=d[0];return function(g){a.Array.Listeners.check(g);var h=g.args[0],i=g.args[1],j=g.args[2],k=g.args[3];b.v=h===a.Array.Operations.add&&0!==i||h===a.Array.Operations.splice&&i>=e&&0===j.length?m.apply(k,[f,b.valueOf()]):m.apply(c._array,d),e=c._array.length}},a.Array.Listeners.reduceRight=function(b,c,d){var e=d[0];return function(f){a.Array.Listeners.check(f);var g=f.args[0],h=f.args[1],i=f.args[2],j=f.args[3];b.v=g===a.Array.Operations.add&&0===h||g===a.Array.Operations.splice&&0===h&&0===i.length?n.apply(j,[e,b.valueOf()]):n.apply(c._array,d)}},a.Array.Listeners.indexOf=function(b,c,d){var e=d[0],f=d[1],h=!!f;return function(i){a.Array.Listeners.check(i);var j,k,l=i.args[0],m=i.args[1],n=i.args[2],o=i.args[3],p=b.valueOf();l===a.Array.Operations.set?n===e?b.v=g.apply(c._array,d):o===e&&(p>m||-1===p)&&(!h||m>=f)&&(b.v=m):l===a.Array.Operations.add?(j=o.indexOf(e),0===m?-1!==j&&(!h||m>=f)?b.v=j:-1!==p&&(b.v=p+o.length):-1===p&&(!h||m>=f)&&-1!==j&&(b.v=m)):l===a.Array.Operations.remove?-1!==p&&(0===m?b.v=n!==e||h?p-1:g.apply(c._array,d):e===n&&(b.v=-1)):l===a.Array.Operations.setLength&&p>=o?b.v=-1:l===a.Array.Operations.reverse||l===a.Array.Operations.sort?b.v=g.apply(c._array,d):l===a.Array.Operations.splice&&(j=o.indexOf(e),k=j+m,p>=m?-1!==j&&p>k&&(!h||k>=f)?b.v=k:o.length!==n.length&&-1===n.indexOf(e)?(p+=o.length-n.length,b.v=!h||p>=f?p:g.apply(c._array,d)):b.v=g.apply(c._array,d):-1===p&&-1!==j&&(b.v=k))}},a.Array.Listeners.lastIndexOf=function(b,c,d){var e=d[0],f=d[1],g=!!f;return function(h){a.Array.Listeners.check(h);var j,k=h.args[0],l=h.args[1],m=h.args[2],n=h.args[3],o=b.valueOf();k===a.Array.Operations.set?m===e?b.v=i.apply(c._array,d):n===e&&(l>o||-1===o)&&(!g||f>=l)&&(b.v=l):k===a.Array.Operations.add?(j=n.indexOf(e),0===l?-1!==j&&-1===o&&(!g||f>=l)?b.v=j:-1!==o&&(b.v=o+n.length):-1!==j&&(!g||f>=l+j)&&(b.v=l+j)):k===a.Array.Operations.remove?-1!==o&&(0===l?b.v=o-1:e===m&&(b.v=i.apply(c._array,d))):(k===a.Array.Operations.splice||k===a.Array.Operations.reverse||k===a.Array.Operations.sort||k===a.Array.Operations.setLength&&m>n)&&(b.v=i.apply(c._array,d))}},a.Array.Listeners.slice=function(b,c,d){var e=d[0],f=d[1],g=!!f;return function(h){a.Array.Listeners.check(h);var i,j=h.args[0],k=h.args[1],l=(h.args[2],h.args[3]);j===a.Array.Operations.set?k>=e&&(!g||f>k)&&(b[k-e]=l):(i=b._array,b._array=q.apply(c._array,d),b.updateByDiff(i))}},a.Property=function(b,c,d,e){Object.defineProperty(this,"proObject",{enumerable:!1,configurable:!0,writeble:!0,value:b}),this.property=c,this.proObject.__pro__||(this.proObject.__pro__={}),this.proObject.__pro__.properties=this.proObject.__pro__.properties||{},this.proObject.__pro__.properties[c]=this,this.get=d||a.Property.DEFAULT_GETTER(this),this.set=e||a.Property.DEFAULT_SETTER(this),this.oldVal=null,this.val=b[c],this.transformators=[],this.state=a.States.init,this.g=this.get,this.s=this.set,a.Observable.call(this),this.init()},a.U.ex(a.Property,{Types:{simple:0,auto:1,object:2,array:3,nil:4,type:function(b){return null===b?a.Property.Types.nil:a.U.isFunction(b)?a.Property.Types.auto:a.U.isArray(b)?a.Property.Types.array:a.U.isObject(b)?a.Property.Types.object:a.Property.Types.simple}},transform:function(a,b){var c,d=a.transformators,e=d.length;for(c=0;e>c;c++)b=d[c].call(a,b);return b},DEFAULT_GETTER:function(a){return function(){return a.addCaller(),a.val}},DEFAULT_SETTER:function(b,c){return function(d){return b.val!==d?(b.oldVal=b.val,b.val=c?c.call(b.proObject,d):a.Property.transform(b,d),null===b.val||void 0===b.val?void a.Property.reProb(b).update():void b.update()):void 0}},defineProp:function(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})},reProb:function(a){var b=a.proObject,c=a.property,d=a.listeners;return a.destroy(),b.__pro__.makeProp(c,d)}}),a.Property.prototype=a.U.ex(Object.create(a.Observable.prototype),{constructor:a.Property,type:function(){return a.Property.Types.simple},makeListener:function(){if(!this.listener){var b=this;this.listener={property:b,call:function(c){b.oldVal=b.val,b.val=a.Property.transform(b,c)}}}return this.listener},init:function(){this.state===a.States.init&&(a.Property.defineProp(this.proObject,this.property,this.get,this.set),this.afterInit())},afterInit:function(){this.state=a.States.ready},addCaller:function(){var b=a.currentCaller;b&&b.property!==this&&this.on(b)},destroy:function(){this.state!==a.States.destroyed&&(delete this.proObject.__pro__.properties[this.property],this.listeners=void 0,this.oldVal=void 0,Object.defineProperty(this.proObject,this.property,{value:this.val,enumerable:!0,configurable:!0}),this.get=this.set=this.property=this.proObject=void 0,this.g=this.s=void 0,this.val=void 0,this.state=a.States.destroyed)},addTransformator:function(a){return this.transformators.push(a),this},toString:function(){return this.val}}),a.NullProperty=function(b,c){var d=this,e=a.Property.DEFAULT_SETTER(this),f=function(b){var c=e.call(d.proObject,b),f=a.Property.Types,g=f.type(c);return g!==f.nil&&a.Property.reProb(d),c};a.Property.call(this,b,c,a.Property.DEFAULT_GETTER(this),f)},a.NullProperty.prototype=a.U.ex(Object.create(a.Property.prototype),{constructor:a.NullProperty,type:function(){return a.Property.Types.nil}}),a.AutoProperty=function(b,c){this.func=b[c];var d=this,e=function(){d.addCaller();var b,c=a.currentCaller,e=a.Property.DEFAULT_GETTER(d),f=a.Property.DEFAULT_SETTER(d,function(a){return d.func.call(d.proObject,a)}),g=arguments;return a.currentCaller=d.makeListener(),b=function(){d.val=d.func.apply(d.proObject,g)},a.flow.run(function(){a.flow.pushOnce(b)}),a.currentCaller=c,a.Property.defineProp(d.proObject,d.property,e,f),d.state=a.States.ready,d.val=a.Property.transform(d,d.val),d.val};a.Property.call(this,b,c,e,function(){})},a.AutoProperty.prototype=a.U.ex(Object.create(a.Property.prototype),{constructor:a.AutoProperty,type:function(){return a.Property.Types.auto},makeListener:function(){if(!this.listener){var b=this;this.listener={property:b,call:function(){b.oldVal=b.val,b.val=a.Property.transform(b,b.func.call(b.proObject))}}}return this.listener},afterInit:function(){}}),a.ObjectProperty=function(b,c){var d,e=this;d=function(){e.addCaller(),e.val.__pro__||a.prob(e.val);var b=a.Property.DEFAULT_GETTER(e),c=function(b){if(e.val!=b){if(e.oldVal=e.val,e.val=b,null===e.val||void 0===e.val)return a.Property.reProb(e).update(),e;if(e.oldVal){e.val.__pro__||a.prob(e.val);var c,d,f,g,h,i,j,k,l,m,n,o=e.oldVal.__pro__.properties,p=e.val.__pro__.properties,q=[];for(c in o)if(o.hasOwnProperty(c)){if(f=p[c],!f)continue;for(h=f.listeners,d=o[c],g=d.listeners,k=g.length,i=0;k>i;i++){for(m=!0,j=0;l>j;j++)g[i]==h[j]&&(m=!1);m&&(f.on(g[i]),q.push(i))}for(n=q.length,i=0;n>i;i++)g.splice[(q[i],1)];q=[]}}e.update()}};return a.Property.defineProp(e.proObject,e.property,b,c),e.state=a.States.ready,e.val},a.Property.call(this,b,c,d,function(){})},a.ObjectProperty.prototype=a.U.ex(Object.create(a.Property.prototype),{constructor:a.ObjectProperty,type:function(){return a.Property.Types.object},afterInit:function(){}}),a.ArrayProperty=function(b,c){var d,e=this;d=function(){e.addCaller(),a.Utils.isProArray(e.val)||(e.val=new a.Array(e.val));var b=a.Property.DEFAULT_GETTER(e),c=function(b){if(e.val!=b&&e.val.valueOf()!=b){if(e.oldVal=e.val,e.val=b,null===e.val||void 0===e.val)return a.Property.reProb(e).update(),e;if(a.Utils.isProArray(e.val)||(e.val=new a.Array(e.val)),e.oldVal){var c,d,f,g=[],h=e.oldVal.indexListeners,i=h.length,j=e.val.indexListeners,k=e.oldVal.lengthListeners,l=k.length,m=e.val.lengthListeners;for(c=0;i>c;c++)d=h[c],d.property&&d.property.proObject===e.proObject&&(j.push(d),g.push(c));for(f=g.length,c=0;f>c;c++)h.splice[(g[c],1)];for(g=[],c=0;l>c;c++)d=k[c],d.property&&d.property.proObject===e.proObject&&(m.push(d),g.push(c));for(f=g.length,c=0;f>c;c++)k.splice[(g[c],1)];g=[]}e.update()}};return a.Property.defineProp(e.proObject,e.property,b,c),e.state=a.States.ready,e.val},a.Property.call(this,b,c,d,function(){})},a.ArrayProperty.prototype=a.U.ex(Object.create(a.Property.prototype),{constructor:a.ArrayProperty,type:function(){return a.Property.Types.array},afterInit:function(){}}),a.Core=function(b){this.object=b,this.properties={},this.state=a.States.init
},a.U.ex(a.Core.prototype,{prob:function(){var b=this,c=this.object,d=a.Configuration,e=d.keyprops,f=d.keypropList;try{for(property in c)this.makeProp(property);e&&-1!==f.indexOf("p")&&Object.defineProperty(c,"p",{enumerable:!1,configurable:!1,writeble:!1,value:function(a){return a&&"*"!==a?b.properties[a]:b}}),this.state=a.States.ready}catch(g){throw this.state=a.States.error,g}},makeProp:function(b,c){var d,e=this.object,f=a.Configuration,g=f.keyprops,h=f.keypropList,i=a.Utils.isFunction,j=a.Utils.isArrayObject,k=a.Utils.isObject;if(g&&-1!==h.indexOf(b))throw Error("The property name "+b+" is a key word for pro objects! Objects passed to Pro.prob can not contain properties named as keyword properties.");return!e.hasOwnProperty(b)||null!==e[b]&&void 0!==e[b]?!e.hasOwnProperty(b)||i(e[b])||j(e[b])||k(e[b])?e.hasOwnProperty(b)&&i(e[b])?d=new a.AutoProperty(e,b):e.hasOwnProperty(b)&&j(e[b])?d=new a.ArrayProperty(e,b):e.hasOwnProperty(b)&&k(e[b])&&(d=new a.ObjectProperty(e,b)):d=new a.Property(e,b):d=new a.NullProperty(e,b),c&&(this.properties[b].listeners=this.properties[b].listeners.concat(c)),d},set:function(a,b){var c=this.object;c[a]=b,this.properties[a]||this.makeProp(a)}}),a.Val=function(b){this.v=b,a.prob(this)},a.U.ex(a.Val.prototype,{type:function(){return this.__pro__.properties.v.type()},on:function(a,b){return this.__pro__.properties.v.on(a,b),this},off:function(a,b){return this.__pro__.properties.v.off(a,b),this},addTransformator:function(a){return this.__pro__.properties.v.addTransformator(a),this},into:function(a){return this.__pro__.properties.v.into(a),this},update:function(a){return this.__pro__.properties.v.update(a),this},willUpdate:function(a){return this.__pro__.properties.v.willUpdate(a),this},valueOf:function(){return this.__pro__.properties.v.val},toString:function(){return this.valueOf().toString()}}),a.prob=function(b){var c=a.Utils.isArray;return null===b||!a.U.isObject(b)&&!c(b)?new a.Val(b):c(b)?new a.Array(b):(Object.defineProperty(b,"__pro__",{enumerable:!1,configurable:!1,writeble:!1,value:new a.Core(b)}),b.__pro__.prob(),b)},a});