!function(a){"object"==typeof module&&"object"==typeof module.exports?module.exports=a():window.Pro=a()}(function(){{var a,b,c,d,e,f,g,h,i={},j=Array.prototype,k=j.concat,l=j.every,m=j.filter,n=j.forEach,o=j.indexOf,p=j.join,q=j.lastIndexOf,r=j.map,s=j.pop,t=j.push,u=j.reduce,v=j.reduceRight,w=j.reverse,x=j.shift,y=j.slice,z=j.some,A=j.sort,B=j.splice,C=j.toLocaleString,D=j.toString;j.unshift}return i.States={init:1,ready:2,destroyed:3,error:4},i.Utils=i.U={isFunction:function(a){return"function"==typeof a},isString:function(a){return"string"==typeof a},isObject:function(a){return"object"==typeof a},isError:function(a){return null!==a&&i.U.isObject(a)&&a.message&&"[object Error]"===Object.prototype.toString.apply(a)},isArray:function(a){return i.U.isObject(a)&&"[object Array]"===Object.prototype.toString.call(a)},isProArray:function(a){return null!==a&&i.U.isObject(a)&&i.U.isArray(a._array)&&void 0!==a.length},isArrayObject:function(a){return i.U.isArray(a)||i.U.isProArray(a)},isProObject:function(a){return a&&i.U.isObject(a)&&void 0!==a.__pro__&&i.U.isObject(a.__pro__.properties)},isProVal:function(a){return i.U.isProObject(a)&&void 0!==a.__pro__.properties.v},ex:function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},bind:function(a,b){return function(){return b.apply(a,arguments)}},contains:function(a,b){-1!==a.indexOf(b)},remove:function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},diff:function(a,b){var c,d,e,f=-1,g=a.length,h=b.length,j={};if(g>=h){for(c=0;h>c;c++)d=a[c],e=b[c],d!==e?(-1===f&&(f=c),j[f]=j[f]||{o:[],n:[]},j[f].o.push(d),j[f].n.push(e)):f=-1;for(-1===f&&(f=c),j[f]=j[f]||{o:[],n:[]};g>c;c++)d=a[c],j[f].o.push(d)}else if(h>g){j=i.U.diff(b,a);for(c in j)el1=j[c],el2=el1.n,el1.n=el1.o,el1.o=el2}return j},defValProp:function(a,b,c,d,e,f){try{Object.defineProperty(a,b,{enumerable:c,configurable:d,writable:e,value:f})}catch(g){a[b]=f}}},i.Configuration={keyprops:!0,keypropList:["p"]},i.N=function(){},i.currentCaller=null,i.Queue=function(a,b){this.name=a||"proq",this.options=b||{},this._queue=[]},i.Queue.runAction=function(a,b,c,d,e){if(d&&d.length>0)if(e)try{c.apply(b,d)}catch(f){e(a,f)}else c.apply(b,d);else if(e)try{c.call(b)}catch(f){e(a,f)}else c.call(b)},i.U.ex(i.Queue.prototype,{constructor:i.Queue,length:function(){return this._queue.length/4},isEmpty:function(){return 0===this.length()},push:function(a,b,c){a&&i.Utils.isFunction(a)&&(c=b,b=a,a=null),this._queue.push(a,b,c,1)},pushOnce:function(a,b,c){a&&i.Utils.isFunction(a)&&(c=b,b=a,a=null);var d,e,f,g=this._queue,h=g.length;for(f=0;h>f;f+=4)if(d=g[f],e=g[f+1],d===a&&e===b)return g[f+2]=c,void(g[f+3]=g[f+3]+1);this.push(a,b,c)},go:function(a){var b,c,d,e,f,g=this._queue,h=this.options,j=(this.runs,g.length),k=h&&h.before,l=h&&h.after,m=h&&h.err,n=j,o=!0,p=1,q=n;for(j&&k&&k(this);o;){for(o=!1,n=q,b=0;n>b;b+=4)c=g[b],d=g[b+1],e=g[b+2],f=g[b+3],f===p?i.Queue.runAction(this,c,d,e,m):f>p&&(o=!0,q=b+4);p+=1}j&&l&&l(this),g.length>j?(this._queue=g.slice(j),a||this.go()):this._queue.length=0}}),i.Queues=function(a,b){a||(a=["proq"]),this.queueNames=a,this.options=b||{},this._queues={};var c,d=this.queueNames.length;for(c=0;d>c;c++)this._queues[this.queueNames[c]]=new i.Queue(this.queueNames[c],this.options.queue)},i.Queues.prototype={},i.Queues.prototype.isEmpty=function(){var a,b,c,d=this._queues,e=this.queueNames,f=e.length;for(a=0;f>a;a++)if(b=e[a],c=d[b],!c.isEmpty())return!1;return!0},i.Queues.prototype.push=function(a,b,c,d){a&&!i.Utils.isString(a)&&(d=c,c=b,b=a,a=this.queueNames[0]),a||(a=this.queueNames[0]);var e=this._queues[a];e&&e.push(b,c,d)},i.Queues.prototype.pushOnce=function(a,b,c,d){a&&!i.Utils.isString(a)&&(d=c,c=b,b=a,a=this.queueNames[0]),a||(a=this.queueNames[0]);var e=this._queues[a];e&&e.pushOnce(b,c,d)},i.Queues.prototype.go=function(a){var b,c,d,e,f=0,g=this._queues,h=this.queueNames,i=this.queueNames.length;if(a)for(b=0;i>b;b++)h[b]===a&&(f=b);for(;i>f;)c=h[f],d=g[c],d.go(!0),-1===(e=this.probePrevIndex(f))?f+=1:f=e},i.Queues.prototype.probePrevIndex=function(a){var b,c,d,e=this._queues,f=this.queueNames;for(b=0;a>=b;b++)if(c=f[b],d=e[c],!d.isEmpty())return b;return-1},i.Flow=function(a,b){a||(a=["proq"]),this.queueNames=a,this.options=b||{},this.flowInstance=null,this.flowInstances=[],this.pauseMode=!1},i.Flow.prototype={constructor:i.Flow,start:function(){var a=this.flowInstance,b=this.options,c=b&&b.start,d=this.queueNames;a&&this.flowInstances.push(a),this.flowInstance=new i.Queues(d,b.flowInstance),c&&c(this.flowInstance)},stop:function(){var a,b=this.flowInstance,c=this.options,d=c&&c.stop;if(b)try{b.go()}finally{this.flowInstance=null,this.flowInstances.length&&(a=this.flowInstances.pop(),this.flowInstance=a),d&&d(b)}},pause:function(){this.pauseMode=!0},resume:function(){this.pauseMode=!1},run:function(a,b){var c=this.options,d=c.err;this.start(),b||(b=a,a=null);try{if(d)try{b.call(a)}catch(e){d(e)}else b.call(a)}finally{this.stop()}},isRunning:function(){return null!==this.flowInstance&&void 0!==this.flowInstance},isPaused:function(){return this.isRunning()&&this.pauseMode},push:function(a,b,c,d){if(!this.flowInstance)throw new Error("Not in running flow!");this.isPaused()||this.flowInstance.push(a,b,c,d)},pushOnce:function(a,b,c,d){if(!this.flowInstance)throw new Error("Not in running flow!");this.isPaused()||this.flowInstance.pushOnce(a,b,c,d)}},i.flow=new i.Flow(["proq"],{err:function(a){i.flow.errStream()?i.flow.errStream().triggerErr(a):console.log(a)},flowInstance:{queue:{err:function(a,b){i.flow.errStream()?i.flow.errStream().triggerErr(b):console.log(b)}}}}),i.Observable=function(a){this.listeners=[],this.errListeners=[],this.sources=[],this.listener=null,this.errListener=null,this.transforms=a?a:[]},i.U.ex(i.Observable,{BadValue:{},transform:function(a,b){var c,d=a.transforms,e=d.length;for(c=0;e>c&&(b=d[c].call(a,b),b!==i.Observable.BadValue);c++);return b}}),i.Observable.prototype={constructor:i.Observable,makeListener:function(){return null},makeErrListener:function(){return null},makeEvent:function(a){return new i.Event(a,this,i.Event.Types.value)},on:function(a,b,c){return i.U.isString(a)||(b=a),i.U.isArray(c)?c.push(b):this.listeners.push(b),this},off:function(a,b,c){return a||b?(i.U.isString(a)||(b=a),i.U.isArray(c)?i.U.remove(c,b):i.U.remove(this.listeners,b),this):void(i.U.isArray(c)?c.length=0:this.listeners=[])},onErr:function(a,b){return this.on(a,b,this.errListeners)},offErr:function(a,b){return this.off(a,b,this.errListeners)},into:function(){var a,b,c=y.call(arguments),d=c.length;for(a=0;d>a;a++)b=c[a],this.sources.push(b),b.on(this.makeListener()),b.onErr(this.makeErrListener());return this},out:function(a){return a.into(this),this},offSource:function(a){return i.U.remove(this.sources,a),a.off(this.listener),a.offErr(this.errListener),this},transform:function(a){return this.transforms.push(a),this},mapping:function(a){return this.transform(a)},filtering:function(a){var b=this;return this.transform(function(c){return a.call(b,c)?c:i.Observable.BadValue})},accumulation:function(a,b){var c=this,d=a;return this.transform(function(a){return d=b.call(c,d,a)})},map:i.N,filter:i.N,accumulate:i.N,reduce:function(a,b){return new i.Val(a).into(this.accumulate(a,b))},update:function(a,b){var c=this;return i.flow.isRunning()?c.willUpdate(a,b):i.flow.run(function(){c.willUpdate(a,b)}),this},willUpdate:function(a,b){var c,d,e=i.U.isArray(b)?b:this.listeners,f=e.length,g=this.makeEvent(a);for(c=0;f>c;c++)d=e[c],this.defer(g,d),d.property&&d.property.willUpdate(g);return this},defer:function(a,b){return i.U.isFunction(b)?i.flow.pushOnce(b,[a]):i.flow.pushOnce(b,b.call,[a]),this}},i.Event=function(a,b,c){this.source=a,this.target=b,this.type=c,this.args=y.call(arguments,3)},i.Event.Types={value:0,array:1,close:2,error:3},i.Stream=function(a,b){i.Observable.call(this,b),a&&this.into(a)},i.Stream.prototype=i.U.ex(Object.create(i.Observable.prototype),{constructor:i.Stream,makeEvent:function(a){return a},makeListener:function(){if(!this.listener){var a=this;this.listener=function(b){a.trigger(b,!0)}}return this.listener},makeErrListener:function(){if(!this.errListener){var a=this;this.errListener=function(b){a.triggerErr(b)}}return this.errListener},defer:function(a,b){return b.property?void i.Observable.prototype.defer.call(this,a,b):void(i.Utils.isFunction(b)?i.flow.push(b,[a]):i.flow.push(b,b.call,[a]))},trigger:function(a,b){return void 0===b&&(b=!0),this.go(a,b)},triggerErr:function(a){return this.update(a,this.errListeners)},go:function(a,b){{var c=this.transforms;c.length}if(b)try{a=i.Observable.transform(this,a)}catch(d){return this.triggerErr(d),this}return a===i.Observable.BadValue?this:this.update(a)},map:function(a){return new i.Stream(this).mapping(a)},filter:function(a){return new i.Stream(this).filtering(a)},accumulate:function(a,b){return new i.Stream(this).accumulation(a,b)},merge:function(a){return(new i.Stream).into(this,a)}}),i.U.ex(i.Flow.prototype,{errStream:function(){return this.errStreamVar||(this.errStreamVar=new i.Stream),this.errStreamVar}}),i.BufferedStream=function(a,b){i.Stream.call(this,a,b),this.buffer=[]},i.BufferedStream.prototype=i.U.ex(Object.create(i.Stream.prototype),{flush:function(){var a,b=this,c=this.buffer,d=c.length;i.flow.run(function(){for(a=0;d>a;a+=2)b.go(c[a],c[a+1]);b.buffer=[]})}}),i.BufferedStream.prototype.constructor=i.BufferedStream,i.SizeBufferedStream=function(a,b,c){if(1===arguments.length&&"number"==typeof a?(c=a,a=null):2===arguments.length&&"number"==typeof b&&(c=b,b=null),i.BufferedStream.call(this,a,b),!c)throw new Error("SizeBufferedStream must contain size!");this.size=c},i.SizeBufferedStream.prototype=i.U.ex(Object.create(i.BufferedStream.prototype),{trigger:function(a,b){this.buffer.push(a,b),null!==this.size&&this.buffer.length/2===this.size&&this.flush()}}),i.SizeBufferedStream.prototype.constructor=i.SizeBufferedStream,i.U.ex(i.Stream.prototype,{bufferit:function(a){return new i.SizeBufferedStream(this,a)}}),i.DelayedStream=function(a,b,c){"number"==typeof a?(c=a,a=null):i.U.isObject(a)&&"number"==typeof b&&(c=b,b=null),i.BufferedStream.call(this,a,b),this.delayId=null,this.setDelay(c)},i.DelayedStream.prototype=i.U.ex(Object.create(i.BufferedStream.prototype),{trigger:function(a,b){this.buffer.push(a,b)},cancelDelay:function(){null!==this.delayId&&(clearInterval(this.delayId),this.delayId=null)},setDelay:function(a){if(this.delay=a,!this.delay)throw new Error("DelayedStream must contain delay!");var b=this;this.delayId=setInterval(function(){b.flush()},this.delay)}}),i.DelayedStream.prototype.constructor=i.DelayedStream,i.U.ex(i.Stream.prototype,{delay:function(a){return new i.DelayedStream(this,a)}}),i.ThrottlingStream=function(a,b,c){i.DelayedStream.call(this,a,b,c)},i.ThrottlingStream.prototype=i.U.ex(Object.create(i.DelayedStream.prototype),{trigger:function(a,b){this.buffer=[],this.buffer.push(a,b)}}),i.ThrottlingStream.prototype.constructor=i.ThrottlingStream,i.U.ex(i.Stream.prototype,{throttle:function(a){return new i.ThrottlingStream(this,a)}}),i.DebouncingStream=function(a,b,c){i.DelayedStream.call(this,a,b,c)},i.DebouncingStream.prototype=i.U.ex(Object.create(i.DelayedStream.prototype),{trigger:function(a,b){this.buffer=[],this.cancelDelay(),this.setDelay(this.delay),this.buffer.push(a,b)}}),i.DebouncingStream.prototype.constructor=i.DebouncingStream,i.U.ex(i.Stream.prototype,{debounce:function(a){return new i.DebouncingStream(this,a)}}),i.Array=a=function(){this._array=0===arguments.length?[]:1===arguments.length&&i.U.isArray(arguments[0])?arguments[0]:y.call(arguments),this.indexListeners=[],this.lastIndexCaller=null,this.lengthListeners=[],this.lastLengthCaller=null;var a,c,d,e,f=this;a=function(){return f.addCaller("length"),f._array.length},c=function(a){return f._array.length!==a?(e=f._array.length,f._array.length=a,f.update(b.setLength,-1,e,a),a):void 0},Object.defineProperty(this,"length",{configurable:!1,enumerable:!0,get:a,set:c}),Object.defineProperty(this,"__pro__",{enumerable:!1,configurable:!1,writeble:!1,value:{}}),this.__pro__.state=i.States.init;try{for(d=0;d<this._array.length;d++)this.defineIndexProp(d);this.__pro__.state=i.States.ready}catch(g){throw this.__pro__.state=i.States.error,g}},i.U.ex(a,{Operations:{set:0,add:1,remove:2,setLength:3,reverse:4,sort:5,splice:6,isIndexOp:function(a){return a===this.set||a===this.reverse||a===this.sort}},reFilter:function(a,b,c){var d=b._array;b._array=m.apply(a._array,c),b.updateByDiff(d)}}),b=a.Operations,i.Array.prototype=c=i.U.ex(Object.create(j),{constructor:i.Array,on:function(a,b){i.U.isString(a)||(b=a,a="change"),"change"===a?(this.lengthListeners.push(b),this.indexListeners.push(b)):"lengthChange"===a?this.lengthListeners.push(b):"indexChange"===a&&this.indexListeners.push(b)},addCaller:function(a){if(!a)return this.addCaller("index"),void this.addCaller("length");var b=i.currentCaller,c=a.charAt(0).toUpperCase()+a.slice(1),d="last"+c+"Caller",e=this[d],f=this[a+"Listeners"];b&&e!==b&&!i.U.contains(f,b)&&(this.on(a+"Change",b),this[d]=b)},defineIndexProp:function(a){var c,d=this,e=d._array,f=i.U.isArray,g=i.U.isObject,h=i.U.isFunction;f(e[a])?new i.ArrayProperty(e,a):h(e[a])||null===e[a]||g(e[a])&&new i.ObjectProperty(e,a),Object.defineProperty(this,a,{enumerable:!0,configurable:!0,get:function(){return d.addCaller("index"),e[a]},set:function(f){e[a]!==f&&(c=e[a],e[a]=f,d.update(b.set,a,c,f))}})},makeEvent:function(a,b,c,d,e){return new i.Event(e,this,i.Event.Types.array,a,b,c,d)},willUpdate:function(a,c,d,e){var f=b.isIndexOp(a)?this.indexListeners:this.lengthListeners;this.willUpdateListeners(f,a,c,d,e)},update:function(a,b,c,d){var e=this;i.flow.isRunning()?this.willUpdate(a,b,c,d):i.flow.run(function(){e.willUpdate(a,b,c,d)})},willUpdateSplice:function(a,c,d){var e,f=b.splice;c&&d&&(0!==c.length||0!==d.length)&&(e=c.length===d.length?this.indexListeners:d.length&&c.length?this.lengthListeners.concat(this.indexListeners):this.lengthListeners,this.willUpdateListeners(e,f,a,c,d))},updateSplice:function(a,b,c){var d=this;i.flow.isRunning()?this.willUpdateSplice(a,b,c):i.flow.run(function(){d.willUpdateSplice(a,b,c)})},willUpdateListeners:function(a,b,c,d,e){var f,g,h=a.length,j=this.makeEvent(b,c,d,e);for(f=0;h>f;f++)g=a[f],i.U.isFunction(g)?i.flow.pushOnce(g,[j]):i.flow.pushOnce(g,g.call,[j]),g.property&&g.property.update(j)},updateByDiff:function(a){var b,c,d=this,e=i.U.diff(a,this._array);for(b in e)c=e[b],c&&d.updateSplice(b,c.o,c.n)},concat:function(){var a,b;return 1===arguments.length&&i.U.isProArray(arguments[0])&&(b=arguments[0],arguments[0]=b._array),a=new i.Array(k.apply(this._array,arguments)),b?(this.on(d.leftConcat(a,this,b)),b.on(d.rightConcat(a,this,b))):this.on(d.leftConcat(a,this,y.call(arguments,0))),a},every:function(){return this.addCaller(),l.apply(this._array,arguments)},pevery:function(){var a=new i.Val(l.apply(this._array,arguments));return this.on(d.every(a,this,arguments)),a},some:function(){return this.addCaller(),z.apply(this._array,arguments)},psome:function(){var a=new i.Val(z.apply(this._array,arguments));return this.on(d.some(a,this,arguments)),a},forEach:function(){return this.addCaller(),n.apply(this._array,arguments)},filter:function(){var a=new i.Array(m.apply(this._array,arguments));return this.on(d.filter(a,this,arguments)),a},map:function(){var a=new i.Array(r.apply(this._array,arguments));return this.on(d.map(a,this,arguments)),a},reduce:function(){return this.addCaller(),u.apply(this._array,arguments)},preduce:function(){var a=new i.Val(u.apply(this._array,arguments));return this.on(d.reduce(a,this,arguments)),a},reduceRight:function(){return this.addCaller(),v.apply(this._array,arguments)},preduceRight:function(){var a=new i.Val(v.apply(this._array,arguments));return this.on(d.reduceRight(a,this,arguments)),a},indexOf:function(){return this.addCaller(),o.apply(this._array,arguments)},pindexOf:function(){var a=new i.Val(o.apply(this._array,arguments));return this.on(d.indexOf(a,this,arguments)),a},lastIndexOf:function(){return this.addCaller(),q.apply(this._array,arguments)},plastindexOf:function(){var a=new i.Val(q.apply(this._array,arguments));return this.on(d.lastIndexOf(a,this,arguments)),a},join:function(){return this.addCaller(),p.apply(this._array,arguments)},pjoin:function(a){var b=this.preduce(function(b,c){return b+a+c},""),c=new i.Val(function(){return b.v?b.v.substring(1):""});return c},toLocaleString:function(){return this.addCaller(),C.apply(this._array,arguments)},toString:function(){return this.addCaller(),D.apply(this._array,arguments)},valueOf:function(){return this.toArray()},slice:function(){var a=new i.Array(y.apply(this._array,arguments));return this.on(d.slice(a,this,arguments)),a},reverse:function(){if(0!==this._array.length){var a=w.apply(this._array,arguments),c=this;return c.update(b.reverse,-1,null,null),a}},sort:function(){if(0!==this._array.length){var a=A.apply(this._array,arguments),c=this,d=arguments;return c.update(b.sort,-1,null,d),a}},splice:function(a,b){var c,d=this._array.length,e=B.apply(this._array,arguments),f=this._array.length,g=this,h=y.call(arguments,2);if(a=~a?a:f-a,b=(null==b?f-a:b)||0,h.length>b)for(c=h.length-b;c--;)this.defineIndexProp(d++);else if(b>h.length)for(c=b-h.length;c--;)delete this[--d];return g.updateSplice(a,e,h),new i.Array(e)},pop:function(){if(0!==this._array.length){var a=s.apply(this._array,arguments),c=this,d=this._array.length;return delete this[d],c.update(b.remove,c._array.length,a,null),a}},push:function(){var a,c,d=arguments,e=arguments.length,f=this;for(a=0;e>a;a++)c=this._array.length,t.call(this._array,arguments[a]),this.defineIndexProp(c);return f.update(b.add,f._array.length-1,null,y.call(d,0)),this._array.length},shift:function(){if(0!==this._array.length){var a=x.apply(this._array,arguments),c=this,d=this._array.length;return delete this[d],c.update(b.remove,0,a,null),a}},unshift:function(){for(var a,c=y.call(arguments,0),d=arguments.length,e=this._array,f=this,a=0;d>a;a++)e.splice(a,0,arguments[a]),this.defineIndexProp(e.length-1);return f.update(b.add,0,null,c),e.length},toArray:function(){var a,b,c=[],d=this._array,e=d.length,f=i.U.isProArray;for(a=0;e>a;a++)b=d[a],f(b)&&(b=b.toArray()),c.push(b);return c},toJSON:function(){return JSON.stringify(this._array)}}),i.Array.Listeners=d=i.Array.Listeners||{check:function(a){if(a.type!==i.Event.Types.array)throw Error("Not implemented for non array events")},leftConcat:function(a,e,f){return function(g){d.check(g);var h,j,l=g.args[0],m=g.args[1],n=g.args[2],o=g.args[3],p=f.length;l===b.set?a[m]=o:l===b.add?(h=y.call(o,0),0===m?c.unshift.apply(a,h):c.splice.apply(a,[a._array.length-p,0].concat(h))):l===b.remove?0===m?c.shift.call(a,n):c.splice.apply(a,[a._array.length-p-1,1]):l===b.setLength?(h=n-o,h>0?c.splice.apply(a,[o,h]):(j=[n,0],j.length=2-h,c.splice.apply(a,j))):l===b.reverse||l===b.sort?(h=a._array,j=i.Utils.isProArray(f)?f._array:f,a._array=k.apply(e._array,j),a.updateByDiff(h)):l===b.splice&&c.splice.apply(a,[m,n.length].concat(o))}},rightConcat:function(a,e,f){return function(g){d.check(g);var h,i=g.args[0],j=g.args[1],l=g.args[2],m=g.args[3],n=e._array.length;i===b.set?a[n+j]=m:i===b.add?0===j?c.splice.apply(a,[n,0].concat(m)):c.push.apply(a,m):i===b.remove?0===j?c.splice.call(a,n,1):c.pop.call(a,l):i===b.setLength?a.length=n+m:i===b.reverse||i===b.sort?(h=a._array,a._array=k.apply(e._array,f._array),a.updateByDiff(h)):i===b.splice&&c.splice.apply(a,[j+n,l.length].concat(m))}},every:function(a,c,e){var f=e[0],g=e[1];return function(h){d.check(h);var i,j=h.args[0],k=(h.args[1],h.args[2]),m=h.args[3];j===b.set?(i=f.call(g,m),a.valueOf()!==!0||i?a.valueOf()===!1&&i&&(a.v=l.apply(c._array,e)):a.v=!1):j===b.add?a.valueOf()===!0&&(a.v=l.call(m,f,g)):j===b.remove?a.valueOf()!==!1||f.call(g,k)||(a.v=l.apply(c._array,e)):j===b.setLength?a.valueOf()===!1&&(a.v=l.apply(c._array,e)):j===b.splice&&(a.valueOf()===!0?a.v=l.call(m,f,g):l.call(m,f,g)&&!l.call(k,f,g)&&(a.v=l.apply(c._array,e)))}},some:function(a,c,e){var f=e[0],g=e[1];return function(h){d.check(h);var i,j=h.args[0],k=(h.args[1],h.args[2]),l=h.args[3];j===b.set?(i=f.call(g,l),a.valueOf()===!1&&i?a.v=!0:a.valueOf()!==!0||i||(a.v=z.apply(c._array,e))):j===b.add?a.valueOf()===!1&&(a.v=z.call(l,f,g)):j===b.remove?a.valueOf()===!0&&f.call(g,k)&&(a.v=z.apply(c._array,e)):j===b.setLength?a.valueOf()===!0&&(a.v=z.apply(c._array,e)):j===b.splice&&(a.valueOf()===!1?a.v=z.call(l,f,g):z.call(k,f,g)&&!z.call(l,f,g)&&(a.v=z.apply(c._array,e)))}},filter:function(e,f,g){var h=g[0],i=g[1];return function(j){d.check(j);var k,l,m,n,o,p,q=j.args[0],r=j.args[1],s=j.args[2],t=j.args[3];if(q===b.set)k=h.call(i,t),l=h.call(i,s),(l===!0||k===!0)&&a.reFilter(f,e,g);else if(q===b.add)if(n=[],m=y.call(t,0),p=m.length,0===r){for(o=p-1;o>=0;)h.apply(i,[m[o],o,f._array])&&n.unshift(m[o]),o--;n.length&&c.unshift.apply(e,n)}else{for(o=0;p>o;)h.apply(i,[m[o],f._array.length-(p-o),f._array])&&n.push(m[o]),o++;n.length&&c.push.apply(e,n)}else q===b.remove?h.apply(i,[s,r,f._array])&&(0===r?e.shift():e.pop()):q===b.setLength?a.reFilter(f,e,g):q===b.reverse?e.reverse():q===b.sort?c.sort.apply(e,t):q===b.splice&&a.reFilter(f,e,g)}},map:function(a,e,f){var g=f[0],h=f[1];return function(f){d.check(f);var i,j,k,l,m=f.args[0],n=f.args[1],o=f.args[2],p=f.args[3];if(m===b.set)a[n]=g.call(h,p);else if(m===b.add)if(l=[],i=y.call(p,0),k=i.length,0===n){for(j=k-1;j>=0;)l[j]=g.apply(h,[i[j],j,e._array]),j--;c.unshift.apply(a,l)}else{for(j=0;k>j;)l[j]=g.apply(h,[i[j],e._array.length-(k-j),e._array]),j++;c.push.apply(a,l)}else if(m===b.remove)0===n?a.shift():a.pop();else if(m===b.setLength)a.length=p;else if(m===b.reverse)a.reverse();else if(m===b.sort)c.sort.apply(a,p);else if(m===b.splice){for(l=[],j=0;j<p.length;)l[j]=g.apply(h,[p[j],j+n,e._array]),j++;c.splice.apply(a,[n,o.length].concat(l))}}},reduce:function(a,c,e){var f=c._array.length,g=e[0];return function(h){d.check(h);var i=h.args[0],j=h.args[1],k=h.args[2],l=h.args[3];a.v=i===b.add&&0!==j||i===b.splice&&j>=f&&0===k.length?u.apply(l,[g,a.valueOf()]):u.apply(c._array,e),f=c._array.length}},reduceRight:function(a,c,e){var f=e[0];return function(g){d.check(g);var h=g.args[0],i=g.args[1],j=g.args[2],k=g.args[3];a.v=h===b.add&&0===i||h===b.splice&&0===i&&0===j.length?v.apply(k,[f,a.valueOf()]):v.apply(c._array,e)}},indexOf:function(a,c,e){var f=e[0],g=e[1],h=!!g;return function(i){d.check(i);var j,k,l=i.args[0],m=i.args[1],n=i.args[2],p=i.args[3],q=a.valueOf();l===b.set?n===f?a.v=o.apply(c._array,e):p===f&&(q>m||-1===q)&&(!h||m>=g)&&(a.v=m):l===b.add?(j=p.indexOf(f),0===m?-1!==j&&(!h||m>=g)?a.v=j:-1!==q&&(a.v=q+p.length):-1===q&&(!h||m>=g)&&-1!==j&&(a.v=m)):l===b.remove?-1!==q&&(0===m?a.v=n!==f||h?q-1:o.apply(c._array,e):f===n&&(a.v=-1)):l===b.setLength&&q>=p?a.v=-1:l===b.reverse||l===b.sort?a.v=o.apply(c._array,e):l===b.splice&&(j=p.indexOf(f),k=j+m,q>=m?-1!==j&&q>k&&(!h||k>=g)?a.v=k:p.length!==n.length&&-1===n.indexOf(f)?(q+=p.length-n.length,a.v=!h||q>=g?q:o.apply(c._array,e)):a.v=o.apply(c._array,e):-1===q&&-1!==j&&(a.v=k))}},lastIndexOf:function(a,c,e){var f=e[0],g=e[1],h=!!g;return function(i){d.check(i);var j,k=i.args[0],l=i.args[1],m=i.args[2],n=i.args[3],o=a.valueOf();k===b.set?m===f?a.v=q.apply(c._array,e):n===f&&(l>o||-1===o)&&(!h||g>=l)&&(a.v=l):k===b.add?(j=n.indexOf(f),0===l?-1!==j&&-1===o&&(!h||g>=l)?a.v=j:-1!==o&&(a.v=o+n.length):-1!==j&&(!h||g>=l+j)&&(a.v=l+j)):k===b.remove?-1!==o&&(0===l?a.v=o-1:f===m&&(a.v=q.apply(c._array,e))):(k===b.splice||k===b.reverse||k===b.sort||k===b.setLength&&m>n)&&(a.v=q.apply(c._array,e))}},slice:function(a,c,e){var f=e[0],g=e[1],h=!!g;return function(i){d.check(i);var j,k=i.args[0],l=i.args[1],m=(i.args[2],i.args[3]);k===b.set?l>=f&&(!h||g>l)&&(a[l-f]=m):(j=a._array,a._array=y.apply(c._array,e),a.updateByDiff(j))}}},i.Property=function(a,b,c,d){Object.defineProperty(this,"proObject",{enumerable:!1,configurable:!0,writeble:!0,value:a}),this.property=b,this.proObject.__pro__||(this.proObject.__pro__={}),this.proObject.__pro__.properties=this.proObject.__pro__.properties||{},this.proObject.__pro__.properties[b]=this,this.get=c||i.Property.DEFAULT_GETTER(this),this.set=d||i.Property.DEFAULT_SETTER(this),this.oldVal=null,this.val=a[b],this.state=i.States.init,this.g=this.get,this.s=this.set,i.Observable.call(this),this.init()},i.U.ex(i.Property,{Types:{simple:0,auto:1,object:2,array:3,nil:4,type:function(a){return null===a?i.Property.Types.nil:i.U.isFunction(a)?i.Property.Types.auto:i.U.isArray(a)?i.Property.Types.array:i.U.isObject(a)?i.Property.Types.object:i.Property.Types.simple}},DEFAULT_GETTER:function(a){return function(){return a.addCaller(),a.val}},DEFAULT_SETTER:function(a,b){return function(c){return a.val!==c?(a.oldVal=a.val,a.val=b?b.call(a.proObject,c):i.Observable.transform(a,c),null===a.val||void 0===a.val?void i.Property.reProb(a).update():void a.update()):void 0}},defineProp:function(a,b,c,d){Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})},reProb:function(a){var b=a.proObject,c=a.property,d=a.listeners;return a.destroy(),b.__pro__.makeProp(c,d)}}),i.Property.prototype=i.U.ex(Object.create(i.Observable.prototype),{constructor:i.Property,type:function(){return i.Property.Types.simple},makeListener:function(){if(!this.listener){var a=this;this.listener={property:a,call:function(b){a.oldVal=a.val,a.val=i.Observable.transform(a,b)}}}return this.listener},init:function(){this.state===i.States.init&&(i.Property.defineProp(this.proObject,this.property,this.get,this.set),this.afterInit())},afterInit:function(){this.state=i.States.ready},addCaller:function(){var a=i.currentCaller;a&&a.property!==this&&this.on(a)},destroy:function(){this.state!==i.States.destroyed&&(delete this.proObject.__pro__.properties[this.property],this.listeners=void 0,this.oldVal=void 0,Object.defineProperty(this.proObject,this.property,{value:this.val,enumerable:!0,configurable:!0}),this.get=this.set=this.property=this.proObject=void 0,this.g=this.s=void 0,this.val=void 0,this.state=i.States.destroyed)},toString:function(){return this.val}}),i.NullProperty=function(a,b){var c=this,d=i.Property.DEFAULT_SETTER(this),e=function(a){var b=d.call(c.proObject,a),e=i.Property.Types,f=e.type(b);return f!==e.nil&&i.Property.reProb(c),b};i.Property.call(this,a,b,i.Property.DEFAULT_GETTER(this),e)},i.NullProperty.prototype=i.U.ex(Object.create(i.Property.prototype),{constructor:i.NullProperty,type:function(){return i.Property.Types.nil}}),i.AutoProperty=function(a,b){this.func=a[b];var c=this,d=function(){c.addCaller();var a,b=i.currentCaller,d=i.Property.DEFAULT_GETTER(c),e=i.Property.DEFAULT_SETTER(c,function(a){return c.func.call(c.proObject,a)}),f=arguments;return i.currentCaller=c.makeListener(),a=function(){c.val=c.func.apply(c.proObject,f)},i.flow.run(function(){i.flow.pushOnce(a)}),i.currentCaller=b,i.Property.defineProp(c.proObject,c.property,d,e),c.state=i.States.ready,c.val=i.Observable.transform(c,c.val),c.val};i.Property.call(this,a,b,d,function(){})},i.AutoProperty.prototype=i.U.ex(Object.create(i.Property.prototype),{constructor:i.AutoProperty,type:function(){return i.Property.Types.auto},makeListener:function(){if(!this.listener){var a=this;this.listener={property:a,call:function(){a.oldVal=a.val,a.val=i.Observable.transform(a,a.func.call(a.proObject))}}}return this.listener},afterInit:function(){}}),i.ObjectProperty=function(a,b){var c,d=this;c=function(){d.addCaller(),d.val.__pro__||i.prob(d.val);var a=i.Property.DEFAULT_GETTER(d),b=function(a){if(d.val!=a){if(d.oldVal=d.val,d.val=a,null===d.val||void 0===d.val)return i.Property.reProb(d).update(),d;if(d.oldVal){d.val.__pro__||i.prob(d.val);var b,c,e,f,g,h,j,k,l,m,n,o=d.oldVal.__pro__.properties,p=d.val.__pro__.properties,q=[];for(b in o)if(o.hasOwnProperty(b)){if(e=p[b],!e)continue;for(g=e.listeners,c=o[b],f=c.listeners,k=f.length,h=0;k>h;h++){for(m=!0,j=0;l>j;j++)f[h]==g[j]&&(m=!1);m&&(e.on(f[h]),q.push(h))}for(n=q.length,h=0;n>h;h++)f.splice[(q[h],1)];q=[]}}d.update()}};return i.Property.defineProp(d.proObject,d.property,a,b),d.state=i.States.ready,d.val},i.Property.call(this,a,b,c,function(){})},i.ObjectProperty.prototype=i.U.ex(Object.create(i.Property.prototype),{constructor:i.ObjectProperty,type:function(){return i.Property.Types.object},afterInit:function(){}}),i.ArrayProperty=function(a,b){var c,d=this;c=function(){d.addCaller(),i.Utils.isProArray(d.val)||(d.val=new i.Array(d.val));var a=i.Property.DEFAULT_GETTER(d),b=function(a){if(d.val!=a&&d.val.valueOf()!=a){if(d.oldVal=d.val,d.val=a,null===d.val||void 0===d.val)return i.Property.reProb(d).update(),d;if(i.Utils.isProArray(d.val)||(d.val=new i.Array(d.val)),d.oldVal){var b,c,e,f=[],g=d.oldVal.indexListeners,h=g.length,j=d.val.indexListeners,k=d.oldVal.lengthListeners,l=k.length,m=d.val.lengthListeners;for(b=0;h>b;b++)c=g[b],c.property&&c.property.proObject===d.proObject&&(j.push(c),f.push(b));for(e=f.length,b=0;e>b;b++)g.splice[(f[b],1)];for(f=[],b=0;l>b;b++)c=k[b],c.property&&c.property.proObject===d.proObject&&(m.push(c),f.push(b));for(e=f.length,b=0;e>b;b++)k.splice[(f[b],1)];f=[]}d.update()}};return i.Property.defineProp(d.proObject,d.property,a,b),d.state=i.States.ready,d.val},i.Property.call(this,a,b,c,function(){})},i.ArrayProperty.prototype=i.U.ex(Object.create(i.Property.prototype),{constructor:i.ArrayProperty,type:function(){return i.Property.Types.array},afterInit:function(){}}),i.Core=function(a,b){this.object=a,this.properties={},this.state=i.States.init,this.meta=b||{}},i.U.ex(i.Core.prototype,{prob:function(){var a=this,b=this.object,c=i.Configuration,d=c.keyprops,e=c.keypropList;try{for(property in b)this.makeProp(property,null,this.meta[property]);d&&-1!==e.indexOf("p")&&i.U.defValProp(b,"p",!1,!1,!1,function(b){return b&&"*"!==b?a.properties[b]:a}),this.state=i.States.ready}catch(f){throw this.state=i.States.error,f}return this},makeProp:function(a,b,c){var d,e=this.object,f=i.Configuration,g=f.keyprops,h=f.keypropList,j=i.Utils.isFunction,k=i.Utils.isArrayObject,l=i.Utils.isObject;if(!c||!("noprop"===c||c.indexOf&&c.indexOf("noprop")>=0)){if(g&&-1!==h.indexOf(a))throw Error("The property name "+a+" is a key word for pro objects! Objects passed to Pro.prob can not contain properties named as keyword properties.");return!e.hasOwnProperty(a)||null!==e[a]&&void 0!==e[a]?!e.hasOwnProperty(a)||j(e[a])||k(e[a])||l(e[a])?e.hasOwnProperty(a)&&j(e[a])?d=new i.AutoProperty(e,a):e.hasOwnProperty(a)&&k(e[a])?d=new i.ArrayProperty(e,a):e.hasOwnProperty(a)&&l(e[a])&&(d=new i.ObjectProperty(e,a)):d=new i.Property(e,a):d=new i.NullProperty(e,a),b&&(this.properties[a].listeners=this.properties[a].listeners.concat(b)),d}},set:function(a,b){var c=this.object;c[a]=b,this.properties[a]||this.makeProp(a)}}),i.Val=function(a){this.v=a,i.prob(this)},i.U.ex(i.Val.prototype,{type:function(){return this.__pro__.properties.v.type()},on:function(a,b){return this.__pro__.properties.v.on(a,b),this},off:function(a,b){return this.__pro__.properties.v.off(a,b),this},addTransformator:function(a){return this.__pro__.properties.v.addTransformator(a),this},into:function(a){return this.__pro__.properties.v.into(a),this},update:function(a){return this.__pro__.properties.v.update(a),this},willUpdate:function(a){return this.__pro__.properties.v.willUpdate(a),this},valueOf:function(){return this.__pro__.properties.v.val},toString:function(){return this.valueOf().toString()}}),i.prob=function(a,b){var c,d=i.Utils.isArray;return null===a||!i.U.isObject(a)&&!d(a)?new i.Val(a):d(a)?new i.Array(a):(c=new i.Core(a,b),Object.defineProperty(a,"__pro__",{enumerable:!1,configurable:!1,writeble:!1,value:c}),c.prob(),a)},i.Registry=i.R=function(){this.providers={}},i.Registry.prototype=e={constructor:i.Registry,register:function(a,b){if(this.providers[a])throw new Error(a+"is already registered in this registry.");return this.providers[a]=b,b.registered&&b.registered(this),this},make:function(a,b){var c,d=y.call(arguments,2),e=this.getProviderByName(a);
return e[0]?(c=e[0].make.apply(e[0],[e[1],e[2]].concat(d)),f.run.apply(null,[c,b,this].concat(d))):null},store:function(a,b){var c=y.call(arguments,2),d=this.getProviderByName(a);return d[0]?d[0].store.apply(d[0],[d[1],b,d[2]].concat(c)):null},get:function(a){var b=this.getProviderByName(a);return b[0]?b[0].get(b[1]):null},getProviderByName:function(a){var b=a.split(":");return[this.providers[b[0]],b[1],b.slice(2)]},toObjectArray:function(a){var b=this;return i.U.isArray(a)?r.call(a,function(a){return b.toObject(a)}):this.toObject(a)},toObject:function(a){if(i.U.isString(a)){var b=this.get(a);return b?b:a}return a}},i.U.ex(i.Registry,{Provider:function(){this.stored={}},StreamProvider:function(){i.Registry.Provider.call(this)},FunctionProvider:function(){i.Registry.Provider.call(this)}}),i.Registry.Provider.prototype={constructor:i.Registry.Provider,make:function(){throw new Error("Abstract!")},store:function(a,b){return this.stored[a]=b},get:function(a){return this.stored[a]},del:function(a){var b=this.get(a);return delete this.stored[a],b},registered:function(){}},i.Registry.StreamProvider.prototype=i.U.ex(Object.create(i.Registry.Provider.prototype),{constructor:i.Registry.StreamProvider,make:function(a){var b;return this.stored[a]=b=new i.Stream,b},registered:function(a){a.s=a.stream=i.U.bind(this,this.get)}}),i.Registry.FunctionProvider.prototype=i.U.ex(Object.create(i.Registry.Provider.prototype),{constructor:i.Registry.FunctionProvider}),i.OpStore={all:{simpleOp:function(a,b){return{sym:b,match:function(a){return a.substring(0,b.length)===b},toOptions:function(b,c){var d,e,f,h=new RegExp(g[a].sym+"(\\w*)\\(([\\s\\S]*)\\)"),i=h.exec(c),j=i[1],k=i[2],l=[],m=y.call(arguments,2);if(j&&l.push(j),k)for(k=k.split(","),f=k.length,e=0;f>e;e++)d=k[e].trim(),"$"===d.charAt(0)&&(d=m[parseInt(d.substring(1),10)-1]),l.push(d);b[a]=l,b.order=b.order||[],b.order.push(a)},action:function(b,c){if(!c||!c[a])return b;var d=c[a];return i.U.isArray(d)||(d=[d]),b[a].apply(b,d)}}}}},h=i.OpStore.all,i.DSL={separator:"|",ops:{into:h.simpleOp("into","<<"),out:h.simpleOp("out",">>"),on:h.simpleOp("on","@"),mapping:h.simpleOp("mapping","map"),filtering:h.simpleOp("filtering","filter"),accumulation:h.simpleOp("accumulation","acc")},optionsFromString:function(a){return f.optionsFromArray.apply(null,[a.split(f.separator)].concat(y.call(arguments,1)))},optionsFromArray:function(a){{var b,c,d,e={},f=a.length;i.R.ops}for(b=0;f>b;b++){c=a[b];for(d in i.DSL.ops)if(d=i.DSL.ops[d],d.match(c)){d.toOptions.apply(d,[e,c].concat(y.call(arguments,1)));break}}return e},run:function(a,b,c){var d,e,h,j,k=i.U.isString,l=y.call(arguments,3);if(b&&k(b)&&(b=f.optionsFromString.apply(null,[b].concat(l))),b&&b instanceof i.Observable&&(b={into:b}),b&&b.order)for(h=b.order.length,e=0;h>e;e++)d=b.order[e],(j=g[d])&&(c&&(b[d]=c.toObjectArray(b[d])),j.action(a,b),delete b[d]);for(j in g)b&&(d=b[j])&&(b[j]=c.toObjectArray(d)),j=g[j],j.action(a,b);return a}},f=i.DSL,g=f.ops,i});